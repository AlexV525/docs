import { Callout } from "nextra-theme-docs";
import Navigation from "components/navigation";

## Test Deployments and Setup Guide
This guide will walk you through the process of creating test deployments, obtaining USDT tokens, depositing them to your wallet, and adding a new node to the cluster. We will provide two SDL (Spheron Declarative Language) examples, one without GPU support and another with GPU support.

<Callout type="info">
Ensure you have the Spheron CLI installed on your local system.
</Callout>


1. Get the binary on the local system.
2. Get some USDT tokens from Arome.
3. Before creating deployments, deposit USDT into your wallet using the following command:

```
spheron payment deposit --token 0x24A05B480235Ccb450bf7Ce7e9F65072Ed732292 --amount 10000
```

4. Use the following command to create a deployment based on your `deployment.yaml` configuration file:

```
spheron deployment create ./deployment.yaml --run-period 1000
```

5. To delete a specific deployment, use the following command and replace `[506]` with your deployment ID:

```
spheron deployment get --lid [506]
```

## SDL Without GPU

```
version: "2.0"

services:
  web:
    image: chentex/random-logger
    expose:
      - port: 8000
        as: 8000
        to:
          - global: true
    env:
      - TEST=test

profiles:
  compute:
    web:
      resources:
        cpu:
          units: 0.1
        memory:
          size: 16Mi
        storage:
          size: 128Mi
  placement:
    spheron:
      attributes:
        region: us-west
      pricing:
        web:
          denom: USDT
          amount: 1 # price per hour

deployment:
  web:
    spheron:
      profile: web
      count: 1
```

## SDL With GPU:

```
version: "2.0"

services:
  gpu-test:
    image: ghcr.io/fboulnois/stable-diffusion-docker
    expose:
      - port: 3000
        as: 80
        to:
          - global: true
    cmd:
      - run
    args:
      - 'An impressionist painting of a parakeet eating spaghetti in the desert'
      - --attention-slicing
      - --xformers-memory-efficient-attention
    env:
      - TEST=test

profiles:
  compute:
    gpu-test:
      resources:
        cpu:
          units: 1
        memory:
          size: 5Gi
        gpu:
          units: 1
          attributes:
            vendor:
              nvidia:
                - model: p4
        storage:
          - size: 10Gi
  placement:
    westcoast:
      attributes:
        region: us-east
      pricing:
        gpu-test:
          denom: USDTT
          amount: 250000000000000000001

deployment:
  gpu-test:
    westcoast:
      profile: gpu-test
      count: 1
```

## Adding a Node to the Cluster

1. Switch to the `spheron` user:

```
sudo su spheron
```

2. Download the `add-agent.sh` script:

```
wget -q https://raw.githubusercontent.com/spheronFdn/provider-deployment/devnet/scripts/add-agent.sh
```

3. Edit the add-agent.sh script to Edit Master node IP and Child node IPs: 

```
SPHERON_NODE1_IP=134.195.196.81 # your master node

# all you child nodes
nodes=(
    ["spheron-node2"]="134.195.196.213"
)
```

4. Run the script

```
sudo chmod +x add-agent.sh
./add-agent.sh
```

By following these steps, you will be able to set up and manage test deployments on the Spheron platform efficiently.

<Navigation name="Test Deployment" />
